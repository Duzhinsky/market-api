# Описание #

В этом репозитории представлена реализация бэкенда для веб-сервиса сравнения цен, аналогичный сервису [Яндекс Товары](https://yandex.ru/products). Обычно взаимодействие с такими сервисами происходит следующим образом:
1. Представители магазинов загружают информацию о своих товарах и категориях. Также можно изменять и удалять информацию о ранее загруженных товарах и категориях.
2. Покупатели, пользуясь веб-приложением, могут искать предложения разных магазинов, сравнивать цены и следить за их динамикой и историей.

Реазлизация представляет собой REST API сервис, который позволяет магазинам загружать и обновлять информацию о товарах, а пользователям - смотреть какие товары были обновлены за последние сутки, а также следить за динамикой цен товара или категории за указанный интервал времени.

# Решение #

Серсвис написан на Java с использованием фреймворка Spring.

Для хранения данных используется три таблицы. В одной хранятся последние обновления данных, во второй - все версии этих данных с датой обновления. Третья используется для оптимизации пересчета средней цены категории при изменении внутри её иерархии. Она содержит в себе сумму всех предложений в ней и подкатегориях, а также их количество.

Разделение таблиц данных было сделано для ускорения поиска при GET /nodes/{id} запросах.


# Сборка #
Перед сборкой сконфигурируйте параметры базы данных. Для этого в папках `src/main/resources` и `src/test/resources` откройте файл `application.properties` и укажите адрес, логин и пароль базы данных.

При деплое сервис работает с базой данных на локальном контейнере. Поэтому конфигурация базы для деплоя проводится через переменные среды в файле `docker-compose.yml`

Для сборки проекта с тестами выполните в терминале из основного каталога.
```bash
./gradlew build
```
Если вы не хотите конфигурировать среду для тестов и прогонять их, выполните
```bash
./gradlew build -x test
```
После этого jar архив будет располагаться в папке `build/libs`

Далее нужно собрать docker-image для сервиса
```bash
docker build --build-arg JAR_FILE=./build/libs/yandex-mega-market-0.0.1-SNAPSHOT.jar -t duzhinsky/yandex-mega-market .
```

# Деплой #
Если вы хотите собрать проект, то выполните шаги из раздела "Сборка"
Если вы хотите использовать версию из репозитория Docker Hub, то получите её далее

Опционально можно изменить конфигурацию базы данных в файле `docker-compose.yml`

Получите образы
```bash
docker-compose pull
```

После чего можно запускать сервис
```bash
docker-compose up
```
